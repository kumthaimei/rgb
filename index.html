<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ESP32 RGB LED Controller</title>

  <style>
    body{font-family:Arial,sans-serif;background:#111;color:#fff;
         text-align:center;padding:24px}
    label{display:inline-block;width:80px;margin:6px 4px}
    input[type=checkbox]{transform:scale(1.4);margin-left:6px;cursor:pointer}
    #sample{width:100px;height:100px;margin:22px auto;border-radius:12px;
            border:2px solid #555;transition:background .2s}
    button{margin:16px;padding:10px 24px;border:none;border-radius:9px;
           cursor:pointer;font-size:1rem}
    a{color:#0af}
    #host{font-size:.9rem;color:#aaa;margin-top:8px}
  </style>
</head>
<body>
  <h2>RGB LED – ON/OFF</h2>

  <div id="sample"></div>

  <label>R <input type="checkbox" id="r"></label>
  <label>G <input type="checkbox" id="g"></label>
  <label>B <input type="checkbox" id="b"></label><br>

  <button onclick="setLed()">Set LED</button>
  <p><a href="#" onclick="runBlink();return false;">Run blink test</a></p>

  <p id="host"></p>

  <script>
    /* ----------------------------------------------
       1.  Ask once for the ESP32’s IP/hostname
    ------------------------------------------------*/
    const ESP32 = (() => {
      let h = localStorage.getItem('esp32_host');
      if (!h) {
        h = prompt('Enter ESP32 IP or hostname (e.g. 192.168.1.50 or esp32.local)');
        if (!h) location.reload();          // user cancelled
        localStorage.setItem('esp32_host', h.trim());
      }
      return h.trim().replace(/\/+$/,'');   // no trailing slash
    })();

    host.textContent = `Target: http://${ESP32}`;

    /* ----------------------------------------------
       2.  UI helpers
    ------------------------------------------------*/
    const cks = ['r','g','b'].map(id => document.getElementById(id));
    cks.forEach(cb => cb.onchange = preview);

    function preview() {
      const rgb = cks.map(cb => cb.checked ? 255 : 0);
      sample.style.background = `rgb(${rgb})`;
    }
    preview();

    /* ----------------------------------------------
       3.  Send LED state
    ------------------------------------------------*/
    async function setLed() {
      const [r,g,b] = cks.map(cb => cb.checked ? 1 : 0);
      try {
        await fetch(`http://${ESP32}/set?R=${r}&G=${g}&B=${b}`, {mode:'no-cors'});
      } catch(err) {
        alert('Fetch failed – is the ESP32 online?\n' + err);
      }
    }

    /* ----------------------------------------------
       4.  Blink‑test helper
    ------------------------------------------------*/
    async function runBlink() {
      try {
        await fetch(`http://${ESP32}/blink`, {mode:'no-cors'});
      } catch(err) {
        alert('Fetch failed – is the ESP32 online?\n' + err);
      }
    }
  </script>
</body>
</html>



